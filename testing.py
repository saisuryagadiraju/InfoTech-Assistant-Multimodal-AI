import json #defining the source file 
import numpy as np
from sentence_transformers import SentenceTransformer, util

# Loading the sentence Transformer model
embedding_model = SentenceTransformer("all-mpnet-base-v2")  # Use a high-performing model

# Function to calculate similarity
def calculate_similarity(expected_response: str, actual_response: str) -> float:
    expected_embedding = embedding_model.encode(expected_response, convert_to_tensor=True)
    actual_embedding = embedding_model.encode(actual_response, convert_to_tensor=True)
    similarity_score = util.pytorch_cos_sim(expected_embedding, actual_embedding).item()
    return similarity_score

#  test cases as list of dictionaries with 'query', 'expected_response', and 'actual_response'
test_cases = [
    {
        "query": "What are benefits of Hammer Sounding",
        "expected_response": """"NDE\nBridge\nActive Infrared Thermography (IRT)\nTechnology\nActive Infrared Thermography (IRT)\nExport PDF\nTarget of Investigation\nActive infrared thermography (IRT) can be used for the detection of subsurface defects in a variety of materials. Main applications of active IRT include detecting the following: \nShallow delamination in concrete members.(1) \nCorrosion of steel members under paints.\nDelamination in fiber-reinforced polymers.(4) \nShallow utilities, honeycombing, and voids in concrete members. \nDescription\nUnlike passive IRT, which uses solar radiation or heat from the surrounding area, active IRT uses an external heat source to induce thermal changes in the material being tested. The heat source can be a propane heater, high-power lamp, infrared (IR) heating element, or flash lamp.(1-5) An IR camera measures IR radiation and converts such measurements into electrical signals. The detection of defects is based on measuring temperature variations on the surface of an element; these variations are caused by different thermal conductivity, specific heat capacity, and thermal conduction because of discontinuities in the element. Thermal images may be captured before the heating period, during the heating period, and during the cooling period. Figure 1 shows the test setup for detecting concrete delaminations in a specimen with active IRT. Areas with shallow delaminations heat up more quickly and develop surface temperatures up to several degrees higher than the surrounding areas of sound steel.(6) \nSource: FHWA. \nFigure 1. Photo. Concrete delamination detection using active IRT. \nActive IRT can be categorized by its applied heating function. Impulse thermography applies a short energy pulse to the measured object with high-energy flash systems. Transient thermography is similar to impulse thermography, but the energy is applied over a period of time. Transient thermography allows the use of low-cost excitation sources, such as halogen lamps or hot-air blowers. Lock-in thermography applies periodic harmonicmodulated energy to the element. The depth range can be set through the modulation frequency of the excitation source to obtain the best possible result. Compared to the transient method, measuring times needed for lock-in thermography are considerably longer. \nPhysical Principle \nIRT is based on measuring thermal radiation emitted by structural elements (figure 2). Thermal radiation, which is in the wavelength range of 0.7\u201314 \u03bcm (0.028\u20130.55 mils) of the electromagnetic spectrum, is controlled by three main properties that influence the heat flow and distribution within a material: thermal conductivity, specific heat capacity, and mass density. Exposing the surface of a material to a radiant heat source, such as an IR heater, will cause an increase in surface temperature and diffusion of heat into the material to achieve thermal equilibrium. Subsurface defects, such as delamination or steel corrosion, interrupt the flow of heat. As a result, the surface temperature will be higher in the area of the defect relative to the surface temperature adjacent to the flaw. Therefore, it will cause higher radiation. \n\u00a9 2016 G. Washer. \nFigure 2. Illustration. Physical principle of active IRT. \nData Acquisition \nActive IRT uses radiant and fan heaters or flash and halogen lamps, thus eliminating dependence on heat from the sun or other natural heating sources. While active IRT may produce better controlled and higher quality results than passive IRT, it is used only in evaluations of smaller elements. IR cameras used for active IRT typically have the ability to capture thermal images at fixed time intervals during the course of testing. Many images are captured during heating and/or cooling of the material and stored for analysis. ASTM\u202fD4788-03, Standard Test Method for Detecting Delaminations in Bridge Decks Using Infrared Thermography, can be used for surface preparation and other steps of data acquisition.(7) \nData Processing \nAn IR thermal camera records a series of IR images or a video. Thermal images in combination with digital camera images facilitate locating potential defects and anomalies on the surface of an element. Data processing involves analyzing thermal images to identify anomalies in the material being tested. Data may be processed in several ways. Temperature anomalies may be observed in the thermal images produced following the heating of the surface. The time series data for individual pixels in the thermal image may be analyzed as shown in figure 3.(8) The amplitude and delay of the peak of this signal are a function of the depth, thickness, and spatial extent of the defect and may be further analyzed to better characterize the defect. \n\u00a9 2016 G. Washer.\n\u0394T = temperature change. \nT\u00b0F = (T\u00b0C \u00d7 1.8) + 32. \nFigure 3. Graph. Surface temperature variations and thermal contrasts as\u202fa\u202ffunction\u202fof\u202ftime.  \nMore advanced methods of processing data from active IRT tests include analyzing the slope of the heating and cooling cycle and time characteristics (i.e., phase) and frequency characteristics of the temperature decay.(9) In most cases, results of the IRT inspection are displayed as an image of part of the surface to identify flaws against the background of sound material. \nData Interpretation \nSimilar to passive IRT, surface temperature from active IRT tests can be presented in colorcoded contour maps (figure 4). Areas with damages or defects manifest as different colors than sound areas. IR images from active IRT tests can be compared to or superimposed on regular photos to enhance the interpretation of conditions by correlating the visible damage, such as spalling on the surface, to thermal anomalies. \nSource: FHWA. \nT\u00b0F = (T\u00b0C \u00d7 1.8) + 32. \nFigure 4. Contour Surface temperature of tiled concrete from an active IRT test. \nAdvantages \nAdvantages of IRT testing include the following: \nTemperatures can be compared directly via an image. \nResults are less dependent on environmental conditions at the time of the test. \nData provided can be processed to infer characteristics of a defect (e.g., size, depth). \nEquipment setup is fast and easy. \nData analysis is generally straightforward, with the inspector looking for hot spots. \nLimitations \nLimitations of IRT testing include the following: \nQuality cameras are often expensive. \nAccurate temperature measurements are hindered by differing emissivity and reflections from other surfaces. \nSurface conditions (e.g., water, oil stains, or debris) can cause problems with data. \nFlaws deeper than 4\u20135 inches (10.16\u201312.7 cm) are difficult to detect in concrete elements. \nHeating large areas may be impractical, so it is used only in surveys of small areas and objects. \nAccess to the inspection surface is required to position the heating source. \nIncreased time is required for testing relative to conventional thermography. \nReferences \nMaser, K. (2004). Active Heating Infrared Thermography for Detection of Subsurface Bridge Deck Deterioration, Transportation Research Board, Washington, DC. \nTanaka, H., Tottori, S., and Nihei, T. (2006). \u201cDetection of concrete spalling using active infrared thermography.\u201d Quarterly Report of RTRI, 47(3), pp. 138\u2013144, Railway Technical Research Institute, Tokyo, Japan.\nWiggenhauser, H. (2002). \u201cActive IR-applications in civil engineering.\u201d Infrared Physics & Technology, 43(3\u20135), pp. 233\u2013238, Elsevier, Amsterdam, Netherlands. \nStarnes, M., Carino, N., and Kausel, E. (2003). \u201cPreliminary Thermography Studies for Quality Control of Concrete Structures Strengthened with Fiber-Reinforced Polymer Composites.\u201d Journal of Materials in Civil Engineering, 15(3), pp. 266\u2013273, American Society of Civil Engineers, Reston,\u202fVA. \nMaierhofer, C., Arndt, R., R\u00f6llig, M., Rieck, C., Walther, A., Scheel, H., and Hillemeier, B. (2006). \u201cApplication of impulse-thermography for non-destructive assessment of concrete structures.\u201d Cement and Concrete Composites, 28(4), pp. 393\u2013401, Elsevier, Amsterdam, Netherlands. \nWasher, G., Dawson, J., Ruiz-Fabian, P., Sultan, A., Trial, M., and Fuchs, P. (2016). Field Testing of Hand-Held Infrared Thermography, Phase \u2161, Report No. cmr 16-007, Missouri Department of Transportation, Jefferson City, MO. \nASTM D4788-03. (2013). \u201cStandard Test Method for Detecting Delaminations in Bridge Decks Using Infrared Thermography.\u201d Book of Standards 04.03, ASTM International, West\u202fConshohocken, PA. \nFenwick, R. (2010). Environmental Effects on Subsurface Defect Detection Without Solar Load, Master\u2019s Thesis, University of Missouri, Columbia, MO. \nMaldague, X.P. (2001). Theory and Practice of Infrared Technology for Nondestructive Testing, Microwave and Optical Engineering Series, Wiley & Sons, New York, NY. \nLast updated on July 16, 2021",
""",
        "actual_response": "NDE Bridge Active Infrared Thermography (IRT) Technology Active Infrared Thermography (IRT) Export PDF Target of Investigation Active infrared thermography (IRT) can be used for the detection of subsurface defects in a variety of materials. Main applications of active IRT include detecting the following: Shallow delamination in concrete members.(1) Corrosion of steel members under paints. Delamination in fiber-reinforced polymers.(4) Shallow utilities, honeycombing, and voids in concrete members. Description Unlike passive IRT, which uses solar radiation or heat from the surrounding area, active IRT uses an external heat source to induce thermal changes in the material being tested.."
    },
    
]

# Defining a threshold for a "correct" answer 
similarity_threshold = 0.85 # for better results we can also increase it as we needed
correct_count = 0 #counter for correct answers

# Evaluate each test case
for case in test_cases:
    similarity_score = calculate_similarity(case["expected_response"], case["actual_response"])
    if similarity_score >= similarity_threshold:
        correct_count += 1
    print(f"Query: {case['query']}")
    print(f"Similarity Score: {similarity_score:.2f} - {'Correct' if similarity_score >= similarity_threshold else 'Incorrect'}\n")

# Calculating accuracy
accuracy = correct_count / len(test_cases) * 100
print(f"Overall Accuracy: {accuracy:.2f}%") #print the output
